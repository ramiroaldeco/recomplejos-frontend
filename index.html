<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reserva tu cancha</title>
  <script>
  const token = "pk.eyJ1IjoicmFtaXJvb28iLCJhIjoiY21jeGkwdG5jMGMyNDJsb2t6aDdycjV5cSJ9.go0w61Fx98bfHbp_V4K0pg";
  const backendUrl = "https://recomplejos-backend.onrender.com";
  let ciudadSeleccionadaCoords = null;
  let complejos = [];

  function autocompletarCiudad() {
    const input = document.getElementById("ciudad");
    const lista = document.getElementById("sugerencias");
    const query = input.value.trim();

    if (query.length < 3) {
      lista.innerHTML = "";
      return;
    }

    fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${token}&autocomplete=true&types=place&country=AR`)
      .then(res => res.json())
      .then(data => {
        lista.innerHTML = "";
        data.features.forEach(lugar => {
          const li = document.createElement("li");
          li.textContent = lugar.place_name;
          li.onclick = () => {
            input.value = lugar.text;
            ciudadSeleccionadaCoords = lugar.center;
            lista.innerHTML = "";
          };
          lista.appendChild(li);
        });
      });
  }

  function calcularDistancia(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat / 2) ** 2 +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLon / 2) ** 2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  async function buscarCanchas() {
    const lista = document.getElementById("listaCanchas");
    lista.innerHTML = "";

    const deporte = document.getElementById("deporte").value;

    try {
      const res = await fetch(`${backendUrl}/datos_complejos?t=${Date.now()}`);
      const datos = await res.json();

      complejos = Object.entries(datos).map(([clave, info]) => ({
        nombre: info.nombre || clave,
        ciudad: info.ciudad || "Sin ciudad",
        lat: info.lat,
        lng: info.lng,
        deporte: "futbol",
        link: `frontend.html?complejo=${clave}`
      }));

      let resultados = complejos.filter(c => c.deporte === deporte);

      if (ciudadSeleccionadaCoords) {
        const [lng, lat] = ciudadSeleccionadaCoords;
        resultados.forEach(c => {
          c.distancia = calcularDistancia(lat, lng, c.lat, c.lng);
        });
        resultados.sort((a, b) => (a.distancia ?? Infinity) - (b.distancia ?? Infinity));
      }

      resultados.forEach(c => {
        const div = document.createElement("div");
        div.className = "club-card";
        div.innerHTML = `<h3>${c.nombre}</h3><p>${c.ciudad}</p>`;
        div.onclick = () => window.location.href = c.link;
        lista.appendChild(div);
      });

      if (resultados.length === 0) {
        lista.innerHTML = "<p>No hay complejos registrados.</p>";
      }
    } catch (error) {
      console.error("Error al cargar complejos:", error);
      lista.innerHTML = "<p style='color:red;'>Error al cargar complejos desde el servidor.</p>";
    }
  }
</script>

  <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #f5f5f5, #d8f3dc);
    }

    header {
      background-color: white;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header img {
      height: 40px;
    }

    header button {
      margin-left: 10px;
      background-color: #00aa55;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
    }

    .hero {
      background: url('https://images.pexels.com/photos/50713/football-ball-sport-soccer-50713.jpeg') no-repeat center center;
      background-size: cover;
      height: 400px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 0 40px;
      color: white;
      text-shadow: 1px 1px 3px black;
    }

    .hero h1 {
      font-size: 48px;
      margin: 0;
    }

    .hero p {
      font-size: 20px;
      margin: 10px 0 30px;
    }

    .buscador {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
      max-width: 800px;
      margin: -40px auto 40px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      position: relative;
    }

    .buscador input, .buscador select {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 200px;
    }

    .buscador button {
      padding: 10px 20px;
      background-color: #00aa55;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #sugerencias {
      list-style: none;
      padding: 0;
      margin: 0;
      background: white;
      border: 1px solid #ccc;
      width: 200px;
      position: absolute;
      top: 90px;
      z-index: 1000;
      max-height: 200px;
      overflow-y: auto;
    }

    #sugerencias li {
      padding: 10px;
      cursor: pointer;
    }

    #sugerencias li:hover {
      background-color: #eee;
    }

    .resultados {
      max-width: 1000px;
      margin: auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 0 20px 40px;
    }

    .club-card {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #ccc;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      cursor: pointer;
      transition: all 0.3s;
    }

    .club-card:hover {
      background-color: #e6f9f0;
      transform: scale(1.02);
    }

    .club-card h3 {
      margin-bottom: 5px;
    }

    .club-card p {
      color: #555;
    }
  </style>
</head>
<body>

  <header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/480px-No_image_available.svg.png" alt="Logo" />
    <div>
      <button onclick="window.location.href='software.html'">Software para clubes</button>
      <button onclick="window.location.href='login.html'">Iniciar sesión</button>
      <button onclick="window.location.href='micomplejo.html'">Mi complejo</button>
    </div>
  </header>

  <div class="hero">
    <h1>Reserva tu cancha al instante</h1>
    <p>Explorá las canchas disponibles en tu ciudad y en tiempo real.</p>
  </div>

  <div class="buscador">
    <input type="text" id="ciudad" placeholder="Buscar Ciudad" oninput="autocompletarCiudad()">
    <ul id="sugerencias"></ul>
    <select id="deporte">
      <option value="futbol">Fútbol</option>
    </select>
    <button onclick="buscarCanchas()">Buscar canchas</button>
  </div>

  <div class="resultados" id="listaCanchas"></div>

</body>
</html>



